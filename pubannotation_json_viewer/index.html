<!DOCTYPE html>
<link rel="stylesheet" type="text/css" href="marker.css">
<html lang="ja">
<head>
<meta charset="UTF-8">
<script src="src/jquery.min.js"></script>
<script>
var annotation_words = [];
var json_file_name ="data2.json"
function json_parse() {
  $.getJSON(json_file_name , function(data) {
    var
      len = data.length;
      i_len = data[0].denotations.length;
      //alert(i_len);
      document.getElementById("demo").innerHTML = data[0].text;
      var var_text = data[0].text

    for(var i = 0; i < i_len; i++) {
      annotation_words.push([var_text.substr(data[0].denotations[i].span.begin, data[0].denotations[i].span.end - data[0].denotations[i].span.begin),data[0].denotations[i].obj]);  
    };
      alert(annotation_words);
  });

};
// ▼①元のHTMLソースを保持しておく変数
var backupOriginal = "";
// ▼②文字列を検索してハイライト用要素を加える処理
function replacer( str, word , att  ) {
    var SearchString = '(' + word + ')';
    var RegularExp = new RegExp( SearchString, "g" );
    var ReplaceString = '<span class="' + att + '">$1</span>';
    var ResString = str.replace( RegularExp , ReplaceString );
    return ResString;
}
// ▼③ハイライトを加える処理
function addhighlight() {
    backupOriginal = document.getElementById("demo").innerHTML;
    var forShow = backupOriginal;
    for(var j = 0; j < annotation_words.length; j++){
      forShow = replacer( forShow, annotation_words[j][0], annotation_words[j][1] );
      //alert(j);
    }
    //forShow = replacer( forShow, "ハイライト", "mark1" );
    document.getElementById("demo").innerHTML = forShow;
}
// ▼④ハイライトを消す処理
function clearhighlight() {
    document.getElementById("demo").innerHTML = backupOriginal;  // バックアップから書き戻す
    backupOriginal = "";    // バックアップを消す
}
function highlightcheck() {
    if( backupOriginal.length == 0 ) {
        // 何もバックアップされていなければ（未ハイライトなので）ハイライトを加える
        addhighlight();
    }
    else {
        // 何かバックアップされていれば（ハイライト済みなので）ハイライトを消す
        clearhighlight();
    }
}
function setfilename() {
    json_file_name = document.getElementById("filename").value;
    alert(json_file_name)
}
</script>
</head>
<body>
    <p>filename：</p>
    <input type="text" name="filename" id="filename" value="data2.json">
    <input type="button" value = "set file name" onclick="setfilename();">
    <p id="demo"></p>
    <input type="button" name="json" value="json" onClick="json_parse()">
    <input type="button" value="ハイライトON/OFF" id="btn-onoff" onClick="highlightcheck()">
</body>
</html>